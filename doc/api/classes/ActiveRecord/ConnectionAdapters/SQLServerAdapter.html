<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: ActiveRecord::ConnectionAdapters::SQLServerAdapter</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">ActiveRecord::ConnectionAdapters::SQLServerAdapter</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter_rb.html">
                vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="AbstractAdapter.html">
                AbstractAdapter
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
In ADO mode, this adapter will ONLY work on Windows systems, since it
relies on Win32OLE, which, to my knowledge, is only available on Windows.
</p>
<p>
This mode also relies on the ADO support in the DBI module. If you are
using the one-click installer of Ruby, then you already have DBI installed,
but the ADO module is <b>NOT</b> installed. You will need to get the latest
source distribution of Ruby-DBI from <a
href="http://ruby-dbi.sourceforge.net">ruby-dbi.sourceforge.net</a>/ unzip
it, and copy the file <tt>src/lib/dbd_ado/ADO.rb</tt> to
<tt>X:/Ruby/lib/ruby/site_ruby/1.8/DBD/ADO/ADO.rb</tt> (you will more than
likely need to create the ADO directory). Once you&#8216;ve installed that
file, you are ready to go.
</p>
<p>
In ODBC mode, the adapter requires the ODBC support in the DBI module which
requires the Ruby ODBC module. Ruby ODBC 0.996 was used in development and
testing, and it is available at <a
href="http://www.ch-werner.de/rubyodbc">www.ch-werner.de/rubyodbc</a>/
</p>
<p>
Options:
</p>
<ul>
<li><tt>:mode</tt> &#8212; ADO or ODBC. Defaults to ADO.

</li>
<li><tt>:username</tt> &#8212; Defaults to sa.

</li>
<li><tt>:password</tt> &#8212; Defaults to empty string.

</li>
</ul>
<p>
ADO specific options:
</p>
<ul>
<li><tt>:host</tt> &#8212; Defaults to localhost.

</li>
<li><tt>:database</tt> &#8212; The name of the database. No default, must be
provided.

</li>
</ul>
<p>
ODBC specific options:
</p>
<ul>
<li><tt>:dsn</tt> &#8212; Defaults to nothing.

</li>
</ul>
<p>
ADO code tested on Windows 2000 and higher systems, running ruby 1.8.2
(2004-07-29) [i386-mswin32], and SQL Server 2000 SP3.
</p>
<p>
ODBC code tested on a Fedora Core 4 system, running FreeTDS 0.63, unixODBC
2.2.11, Ruby ODBC 0.996, Ruby DBI 0.0.23 and Ruby 1.8.2. [Linux strongmad
2.6.11-1.1369_FC4 1 Thu Jun 2 22:55:56 EDT 2005 i686 i686 i386 GNU/Linux]
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000775">active?</a>&nbsp;&nbsp;
      <a href="#M000774">adapter_name</a>&nbsp;&nbsp;
      <a href="#M000797">add_column</a>&nbsp;&nbsp;
      <a href="#M000789">add_limit_offset!</a>&nbsp;&nbsp;
      <a href="#M000783">begin_db_transaction</a>&nbsp;&nbsp;
      <a href="#M000778">columns</a>&nbsp;&nbsp;
      <a href="#M000784">commit_db_transaction</a>&nbsp;&nbsp;
      <a href="#M000792">create_database</a>&nbsp;&nbsp;
      <a href="#M000793">current_database</a>&nbsp;&nbsp;
      <a href="#M000781">delete</a>&nbsp;&nbsp;
      <a href="#M000777">disconnect!</a>&nbsp;&nbsp;
      <a href="#M000791">drop_database</a>&nbsp;&nbsp;
      <a href="#M000782">execute</a>&nbsp;&nbsp;
      <a href="#M000795">indexes</a>&nbsp;&nbsp;
      <a href="#M000779">insert</a>&nbsp;&nbsp;
      <a href="#M000773">native_database_types</a>&nbsp;&nbsp;
      <a href="#M000772">new</a>&nbsp;&nbsp;
      <a href="#M000786">quote</a>&nbsp;&nbsp;
      <a href="#M000788">quote_column_name</a>&nbsp;&nbsp;
      <a href="#M000787">quote_string</a>&nbsp;&nbsp;
      <a href="#M000776">reconnect!</a>&nbsp;&nbsp;
      <a href="#M000790">recreate_database</a>&nbsp;&nbsp;
      <a href="#M000801">remove_check_constraints</a>&nbsp;&nbsp;
      <a href="#M000799">remove_column</a>&nbsp;&nbsp;
      <a href="#M000800">remove_default_constraint</a>&nbsp;&nbsp;
      <a href="#M000802">remove_index</a>&nbsp;&nbsp;
      <a href="#M000798">rename_column</a>&nbsp;&nbsp;
      <a href="#M000796">rename_table</a>&nbsp;&nbsp;
      <a href="#M000785">rollback_db_transaction</a>&nbsp;&nbsp;
      <a href="#M000794">tables</a>&nbsp;&nbsp;
      <a href="#M000780">update</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000772" class="method-detail">
        <a name="M000772"></a>

        <div class="method-heading">
          <a href="#M000772" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(connection, logger, connection_options=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000772-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000772-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 189</span>
189:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">logger</span>, <span class="ruby-identifier">connection_options</span>=<span class="ruby-keyword kw">nil</span>)
190:         <span class="ruby-keyword kw">super</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">logger</span>)
191:         <span class="ruby-ivar">@connection_options</span> = <span class="ruby-identifier">connection_options</span>
192:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000775" class="method-detail">
        <a name="M000775"></a>

        <div class="method-heading">
          <a href="#M000775" class="method-signature">
          <span class="method-name">active?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the connection is active.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000775-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000775-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 234</span>
234:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">active?</span>
235:         <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-value str">&quot;SELECT 1&quot;</span>).<span class="ruby-identifier">finish</span>
236:         <span class="ruby-keyword kw">true</span>
237:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">DBI</span><span class="ruby-operator">::</span><span class="ruby-constant">DatabaseError</span>, <span class="ruby-constant">DBI</span><span class="ruby-operator">::</span><span class="ruby-constant">InterfaceError</span>
238:         <span class="ruby-keyword kw">false</span>
239:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000774" class="method-detail">
        <a name="M000774"></a>

        <div class="method-heading">
          <a href="#M000774" class="method-signature">
          <span class="method-name">adapter_name</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000774-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000774-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 211</span>
211:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">adapter_name</span>
212:         <span class="ruby-value str">'SQLServer'</span>
213:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000797" class="method-detail">
        <a name="M000797"></a>

        <div class="method-heading">
          <a href="#M000797" class="method-signature">
          <span class="method-name">add_column</span><span class="method-args">(table_name, column_name, type, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds a <a href="SQLServerAdapter.html#M000772">new</a> column to the named
table. See <a
href="TableDefinition.html#M000806">TableDefinition#column</a> for details
of the options you can use.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000797-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000797-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 448</span>
448:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_column</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">column_name</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">options</span> = {})
449:         <span class="ruby-identifier">add_column_sql</span> = <span class="ruby-node">&quot;ALTER TABLE #{table_name} ADD #{quote_column_name(column_name)} #{type_to_sql(type, options[:limit], options[:precision], options[:scale])}&quot;</span>
450:         <span class="ruby-identifier">add_column_options!</span>(<span class="ruby-identifier">add_column_sql</span>, <span class="ruby-identifier">options</span>)
451:         <span class="ruby-comment cmt"># TODO: Add support to mimic date columns, using constraints to mark them as such in the database</span>
452:         <span class="ruby-comment cmt"># add_column_sql &lt;&lt; &quot; CONSTRAINT ck__#{table_name}__#{column_name}__date_only CHECK ( CONVERT(CHAR(12), #{quote_column_name(column_name)}, 14)='00:00:00:000' )&quot; if type == :date       </span>
453:         <span class="ruby-identifier">execute</span>(<span class="ruby-identifier">add_column_sql</span>)
454:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000789" class="method-detail">
        <a name="M000789"></a>

        <div class="method-heading">
          <a href="#M000789" class="method-signature">
          <span class="method-name">add_limit_offset!</span><span class="method-args">(sql, options)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000789-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000789-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 364</span>
364:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_limit_offset!</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">options</span>)
365:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:limit</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:offset</span>]
366:           <span class="ruby-identifier">total_rows</span> = <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">select_all</span>(<span class="ruby-node">&quot;SELECT count(*) as TotalRows from (#{sql.gsub(/\bSELECT(\s+DISTINCT)?\b/i, &quot;SELECT#{$1} TOP 1000000000&quot;)}) tally&quot;</span>)[<span class="ruby-value">0</span>][<span class="ruby-identifier">:TotalRows</span>].<span class="ruby-identifier">to_i</span>
367:           <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:limit</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:offset</span>]) <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">total_rows</span>
368:             <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:limit</span>] = (<span class="ruby-identifier">total_rows</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:offset</span>] <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span>) <span class="ruby-operator">?</span> (<span class="ruby-identifier">total_rows</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:offset</span>]) <span class="ruby-operator">:</span> <span class="ruby-value">0</span>
369:           <span class="ruby-keyword kw">end</span>
370:           <span class="ruby-identifier">sql</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp re">/^\s*SELECT(\s+DISTINCT)?/i</span>, <span class="ruby-node">&quot;SELECT * FROM (SELECT TOP #{options[:limit]} * FROM (SELECT#{$1} TOP #{options[:limit] + options[:offset]} &quot;</span>)
371:           <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;) AS tmp1&quot;</span>
372:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:order</span>]
373:             <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:order</span>] = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:order</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">','</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>
374:               <span class="ruby-identifier">parts</span> = <span class="ruby-identifier">field</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot; &quot;</span>)
375:               <span class="ruby-identifier">tc</span> = <span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span>]
376:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sql</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\.\[/</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">tc</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\./</span> <span class="ruby-comment cmt"># if column quoting used in query</span>
377:                 <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\./</span>, <span class="ruby-value str">'\\.\\['</span>)
378:                 <span class="ruby-identifier">tc</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'\\]'</span>
379:               <span class="ruby-keyword kw">end</span>
380:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sql</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/#{tc} AS (t\d_r\d\d?)/</span>
381:                 <span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span>] = <span class="ruby-identifier">$1</span>
382:               <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\w+\.(\w+)/</span>
383:                 <span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span>] = <span class="ruby-identifier">$1</span>
384:               <span class="ruby-keyword kw">end</span>
385:               <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' '</span>)
386:             <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">', '</span>)
387:             <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot; ORDER BY #{change_order_direction(options[:order])}) AS tmp2 ORDER BY #{options[:order]}&quot;</span>
388:           <span class="ruby-keyword kw">else</span>
389:             <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; ) AS tmp2&quot;</span>
390:           <span class="ruby-keyword kw">end</span>
391:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">sql</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp re">/^\s*SELECT (@@|COUNT\()/i</span>
392:           <span class="ruby-identifier">sql</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp re">/^\s*SELECT(\s+DISTINCT)?/i</span>) <span class="ruby-keyword kw">do</span>
393:             <span class="ruby-node">&quot;SELECT#{$1} TOP #{options[:limit]}&quot;</span>
394:           <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:limit</span>].<span class="ruby-identifier">nil?</span>
395:         <span class="ruby-keyword kw">end</span>
396:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000783" class="method-detail">
        <a name="M000783"></a>

        <div class="method-heading">
          <a href="#M000783" class="method-signature">
          <span class="method-name">begin_db_transaction</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000783-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000783-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 326</span>
326:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">begin_db_transaction</span>
327:         <span class="ruby-ivar">@connection</span>[<span class="ruby-value str">&quot;AutoCommit&quot;</span>] = <span class="ruby-keyword kw">false</span>
328:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
329:         <span class="ruby-ivar">@connection</span>[<span class="ruby-value str">&quot;AutoCommit&quot;</span>] = <span class="ruby-keyword kw">true</span>
330:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000778" class="method-detail">
        <a name="M000778"></a>

        <div class="method-heading">
          <a href="#M000778" class="method-signature">
          <span class="method-name">columns</span><span class="method-args">(table_name, name = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000778-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000778-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 256</span>
256:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">columns</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">name</span> = <span class="ruby-keyword kw">nil</span>)
257:         <span class="ruby-keyword kw">return</span> [] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">blank?</span>
258:         <span class="ruby-identifier">table_name</span> = <span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>)
259:         <span class="ruby-identifier">table_name</span> = <span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'.'</span>)[<span class="ruby-value">-1</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">nil?</span>
260:         <span class="ruby-identifier">table_name</span> = <span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/[\[\]]/</span>, <span class="ruby-value str">''</span>)
261:         <span class="ruby-identifier">sql</span> = <span class="ruby-node">%Q{
262:           SELECT 
263:             cols.COLUMN_NAME as ColName,  
264:             cols.COLUMN_DEFAULT as DefaultValue,
265:             cols.NUMERIC_SCALE as numeric_scale,
266:             cols.NUMERIC_PRECISION as numeric_precision, 
267:             cols.DATA_TYPE as ColType, 
268:             cols.IS_NULLABLE As IsNullable,  
269:             COL_LENGTH(cols.TABLE_NAME, cols.COLUMN_NAME) as Length,  
270:             COLUMNPROPERTY(OBJECT_ID(cols.TABLE_NAME), cols.COLUMN_NAME, 'IsIdentity') as IsIdentity,  
271:             cols.NUMERIC_SCALE as Scale 
272:           FROM INFORMATION_SCHEMA.COLUMNS cols 
273:           WHERE cols.TABLE_NAME = '#{table_name}'   
274:         }</span>
275:         <span class="ruby-comment cmt"># Comment out if you want to have the Columns select statment logged.</span>
276:         <span class="ruby-comment cmt"># Personally, I think it adds unnecessary bloat to the log. </span>
277:         <span class="ruby-comment cmt"># If you do comment it out, make sure to un-comment the &quot;result&quot; line that follows</span>
278:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">log</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">name</span>) { <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">select_all</span>(<span class="ruby-identifier">sql</span>) }
279:         <span class="ruby-comment cmt">#result = @connection.select_all(sql)</span>
280:         <span class="ruby-identifier">columns</span> = []
281:         <span class="ruby-identifier">result</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>
282:           <span class="ruby-identifier">default</span> = <span class="ruby-identifier">field</span>[<span class="ruby-identifier">:DefaultValue</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/[()\']/</span>,<span class="ruby-value str">&quot;&quot;</span>) <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/null/</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">field</span>[<span class="ruby-identifier">:DefaultValue</span>]
283:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">field</span>[<span class="ruby-identifier">:ColType</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/numeric|decimal/i</span>
284:             <span class="ruby-identifier">type</span> = <span class="ruby-node">&quot;#{field[:ColType]}(#{field[:numeric_precision]},#{field[:numeric_scale]})&quot;</span>
285:           <span class="ruby-keyword kw">else</span>
286:             <span class="ruby-identifier">type</span> = <span class="ruby-node">&quot;#{field[:ColType]}(#{field[:Length]})&quot;</span>
287:           <span class="ruby-keyword kw">end</span>
288:           <span class="ruby-identifier">is_identity</span> = <span class="ruby-identifier">field</span>[<span class="ruby-identifier">:IsIdentity</span>] <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
289:           <span class="ruby-identifier">is_nullable</span> = <span class="ruby-identifier">field</span>[<span class="ruby-identifier">:IsNullable</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">'YES'</span>
290:           <span class="ruby-identifier">columns</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">SQLServerColumn</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">field</span>[<span class="ruby-identifier">:ColName</span>], <span class="ruby-identifier">default</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">is_identity</span>, <span class="ruby-identifier">is_nullable</span>)
291:         <span class="ruby-keyword kw">end</span>
292:         <span class="ruby-identifier">columns</span>
293:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000784" class="method-detail">
        <a name="M000784"></a>

        <div class="method-heading">
          <a href="#M000784" class="method-signature">
          <span class="method-name">commit_db_transaction</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000784-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000784-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 332</span>
332:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">commit_db_transaction</span>
333:         <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">commit</span>
334:       <span class="ruby-keyword kw">ensure</span>
335:         <span class="ruby-ivar">@connection</span>[<span class="ruby-value str">&quot;AutoCommit&quot;</span>] = <span class="ruby-keyword kw">true</span>
336:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000792" class="method-detail">
        <a name="M000792"></a>

        <div class="method-heading">
          <a href="#M000792" class="method-signature">
          <span class="method-name">create_database</span><span class="method-args">(name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000792-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000792-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 407</span>
407:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_database</span>(<span class="ruby-identifier">name</span>)
408:         <span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;CREATE DATABASE #{name}&quot;</span>
409:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000793" class="method-detail">
        <a name="M000793"></a>

        <div class="method-heading">
          <a href="#M000793" class="method-signature">
          <span class="method-name">current_database</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000793-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000793-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 411</span>
411:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">current_database</span>
412:         <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">select_one</span>(<span class="ruby-value str">&quot;select DB_NAME()&quot;</span>)[<span class="ruby-value">0</span>]
413:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000781" class="method-detail">
        <a name="M000781"></a>

        <div class="method-heading">
          <span class="method-name">delete</span><span class="method-args">(sql, name = nil)</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="SQLServerAdapter.html#M000780">update</a>
</p>
        </div>
      </div>

      <div id="method-M000777" class="method-detail">
        <a name="M000777"></a>

        <div class="method-heading">
          <a href="#M000777" class="method-signature">
          <span class="method-name">disconnect!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Disconnects from the database
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000777-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000777-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 252</span>
252:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">disconnect!</span>
253:         <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">disconnect</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
254:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000791" class="method-detail">
        <a name="M000791"></a>

        <div class="method-heading">
          <a href="#M000791" class="method-signature">
          <span class="method-name">drop_database</span><span class="method-args">(name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000791-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000791-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 403</span>
403:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">drop_database</span>(<span class="ruby-identifier">name</span>)
404:         <span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;DROP DATABASE #{name}&quot;</span>
405:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000782" class="method-detail">
        <a name="M000782"></a>

        <div class="method-heading">
          <a href="#M000782" class="method-signature">
          <span class="method-name">execute</span><span class="method-args">(sql, name = nil) {|handle| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000782-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000782-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 308</span>
308:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">execute</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">name</span> = <span class="ruby-keyword kw">nil</span>)
309:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sql</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\s*INSERT/i</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">table_name</span> = <span class="ruby-identifier">query_requires_identity_insert?</span>(<span class="ruby-identifier">sql</span>))
310:           <span class="ruby-identifier">log</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">name</span>) <span class="ruby-keyword kw">do</span>
311:             <span class="ruby-identifier">with_identity_insert_enabled</span>(<span class="ruby-identifier">table_name</span>) <span class="ruby-keyword kw">do</span> 
312:               <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-identifier">sql</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">handle</span><span class="ruby-operator">|</span>
313:                 <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">handle</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
314:               <span class="ruby-keyword kw">end</span>
315:             <span class="ruby-keyword kw">end</span>
316:           <span class="ruby-keyword kw">end</span>
317:         <span class="ruby-keyword kw">else</span>
318:           <span class="ruby-identifier">log</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">name</span>) <span class="ruby-keyword kw">do</span>
319:             <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-identifier">sql</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">handle</span><span class="ruby-operator">|</span>
320:               <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">handle</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
321:             <span class="ruby-keyword kw">end</span>
322:           <span class="ruby-keyword kw">end</span>
323:         <span class="ruby-keyword kw">end</span>
324:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000795" class="method-detail">
        <a name="M000795"></a>

        <div class="method-heading">
          <a href="#M000795" class="method-signature">
          <span class="method-name">indexes</span><span class="method-args">(table_name, name = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000795-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000795-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 425</span>
425:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">indexes</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">name</span> = <span class="ruby-keyword kw">nil</span>)
426:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-value str">&quot;@connection&quot;</span>)[<span class="ruby-value str">&quot;AutoCommit&quot;</span>] = <span class="ruby-keyword kw">false</span>
427:         <span class="ruby-identifier">indexes</span> = []        
428:         <span class="ruby-identifier">execute</span>(<span class="ruby-node">&quot;EXEC sp_helpindex '#{table_name}'&quot;</span>, <span class="ruby-identifier">name</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sth</span><span class="ruby-operator">|</span>
429:           <span class="ruby-identifier">sth</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">index</span><span class="ruby-operator">|</span> 
430:             <span class="ruby-identifier">unique</span> = <span class="ruby-identifier">index</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/unique/</span>
431:             <span class="ruby-identifier">primary</span> = <span class="ruby-identifier">index</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/primary key/</span>
432:             <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">primary</span>
433:               <span class="ruby-identifier">indexes</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">IndexDefinition</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">index</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">unique</span>, <span class="ruby-identifier">index</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;, &quot;</span>))
434:             <span class="ruby-keyword kw">end</span>
435:           <span class="ruby-keyword kw">end</span>
436:         <span class="ruby-keyword kw">end</span>
437:         <span class="ruby-identifier">indexes</span>
438:         <span class="ruby-keyword kw">ensure</span>
439:           <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-value str">&quot;@connection&quot;</span>)[<span class="ruby-value str">&quot;AutoCommit&quot;</span>] = <span class="ruby-keyword kw">true</span>
440:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000779" class="method-detail">
        <a name="M000779"></a>

        <div class="method-heading">
          <a href="#M000779" class="method-signature">
          <span class="method-name">insert</span><span class="method-args">(sql, name = nil, pk = nil, id_value = nil, sequence_name = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000779-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000779-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 295</span>
295:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">insert</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">name</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">pk</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">id_value</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">sequence_name</span> = <span class="ruby-keyword kw">nil</span>)
296:         <span class="ruby-identifier">execute</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">name</span>)
297:         <span class="ruby-identifier">id_value</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">select_one</span>(<span class="ruby-value str">&quot;SELECT @@IDENTITY AS Ident&quot;</span>)[<span class="ruby-value str">&quot;Ident&quot;</span>]
298:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000773" class="method-detail">
        <a name="M000773"></a>

        <div class="method-heading">
          <a href="#M000773" class="method-signature">
          <span class="method-name">native_database_types</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000773-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000773-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 194</span>
194:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">native_database_types</span>
195:         {
196:           <span class="ruby-identifier">:primary_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;int NOT NULL IDENTITY(1, 1) PRIMARY KEY&quot;</span>,
197:           <span class="ruby-identifier">:string</span>      =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;varchar&quot;</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">255</span>  },
198:           <span class="ruby-identifier">:text</span>        =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;text&quot;</span> },
199:           <span class="ruby-identifier">:integer</span>     =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;int&quot;</span> },
200:           <span class="ruby-identifier">:float</span>       =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;float&quot;</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">8</span> },
201:           <span class="ruby-identifier">:decimal</span>     =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;decimal&quot;</span> },
202:           <span class="ruby-identifier">:datetime</span>    =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;datetime&quot;</span> },
203:           <span class="ruby-identifier">:timestamp</span>   =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;datetime&quot;</span> },
204:           <span class="ruby-identifier">:time</span>        =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;datetime&quot;</span> },
205:           <span class="ruby-identifier">:date</span>        =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;datetime&quot;</span> },
206:           <span class="ruby-identifier">:binary</span>      =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;image&quot;</span>},
207:           <span class="ruby-identifier">:boolean</span>     =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;bit&quot;</span>}
208:         }
209:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000786" class="method-detail">
        <a name="M000786"></a>

        <div class="method-heading">
          <a href="#M000786" class="method-signature">
          <span class="method-name">quote</span><span class="method-args">(value, column = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000786-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000786-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 344</span>
344:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">quote</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">column</span> = <span class="ruby-keyword kw">nil</span>)
345:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">quoted_id</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:quoted_id</span>)
346: 
347:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">value</span>
348:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TrueClass</span>             <span class="ruby-keyword kw">then</span> <span class="ruby-value str">'1'</span>
349:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">FalseClass</span>            <span class="ruby-keyword kw">then</span> <span class="ruby-value str">'0'</span>
350:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Time</span>, <span class="ruby-constant">DateTime</span>        <span class="ruby-keyword kw">then</span> <span class="ruby-node">&quot;'#{value.strftime(&quot;%Y%m%d %H:%M:%S&quot;)}'&quot;</span>
351:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Date</span>                  <span class="ruby-keyword kw">then</span> <span class="ruby-node">&quot;'#{value.strftime(&quot;%Y%m%d&quot;)}'&quot;</span>
352:           <span class="ruby-keyword kw">else</span>                       <span class="ruby-keyword kw">super</span>
353:         <span class="ruby-keyword kw">end</span>
354:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000788" class="method-detail">
        <a name="M000788"></a>

        <div class="method-heading">
          <a href="#M000788" class="method-signature">
          <span class="method-name">quote_column_name</span><span class="method-args">(name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000788-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000788-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 360</span>
360:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">quote_column_name</span>(<span class="ruby-identifier">name</span>)
361:         <span class="ruby-node">&quot;[#{name}]&quot;</span>
362:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000787" class="method-detail">
        <a name="M000787"></a>

        <div class="method-heading">
          <a href="#M000787" class="method-signature">
          <span class="method-name">quote_string</span><span class="method-args">(string)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000787-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000787-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 356</span>
356:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">quote_string</span>(<span class="ruby-identifier">string</span>)
357:         <span class="ruby-identifier">string</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\'/</span>, <span class="ruby-value str">&quot;''&quot;</span>)
358:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000776" class="method-detail">
        <a name="M000776"></a>

        <div class="method-heading">
          <a href="#M000776" class="method-signature">
          <span class="method-name">reconnect!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Reconnects to the database, returns false if no connection could be made.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000776-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000776-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 242</span>
242:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reconnect!</span>
243:         <span class="ruby-identifier">disconnect!</span>
244:         <span class="ruby-ivar">@connection</span> = <span class="ruby-constant">DBI</span>.<span class="ruby-identifier">connect</span>(<span class="ruby-operator">*</span><span class="ruby-ivar">@connection_options</span>)
245:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">DBI</span><span class="ruby-operator">::</span><span class="ruby-constant">DatabaseError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
246:         <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;#{adapter_name} reconnection failed: #{e.message}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@logger</span>
247:         <span class="ruby-keyword kw">false</span>
248:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000790" class="method-detail">
        <a name="M000790"></a>

        <div class="method-heading">
          <a href="#M000790" class="method-signature">
          <span class="method-name">recreate_database</span><span class="method-args">(name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000790-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000790-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 398</span>
398:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">recreate_database</span>(<span class="ruby-identifier">name</span>)
399:         <span class="ruby-identifier">drop_database</span>(<span class="ruby-identifier">name</span>)
400:         <span class="ruby-identifier">create_database</span>(<span class="ruby-identifier">name</span>)
401:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000801" class="method-detail">
        <a name="M000801"></a>

        <div class="method-heading">
          <a href="#M000801" class="method-signature">
          <span class="method-name">remove_check_constraints</span><span class="method-args">(table_name, column_name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000801-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000801-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 485</span>
485:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_check_constraints</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">column_name</span>)
486:         <span class="ruby-comment cmt"># TODO remove all constraints in single method</span>
487:         <span class="ruby-identifier">constraints</span> = <span class="ruby-identifier">select</span> <span class="ruby-node">&quot;SELECT CONSTRAINT_NAME FROM INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE where TABLE_NAME = '#{table_name}' and COLUMN_NAME = '#{column_name}'&quot;</span>
488:         <span class="ruby-identifier">constraints</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">constraint</span><span class="ruby-operator">|</span>
489:           <span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;ALTER TABLE #{table_name} DROP CONSTRAINT #{constraint[&quot;CONSTRAINT_NAME&quot;]}&quot;</span>
490:         <span class="ruby-keyword kw">end</span>
491:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000799" class="method-detail">
        <a name="M000799"></a>

        <div class="method-heading">
          <a href="#M000799" class="method-signature">
          <span class="method-name">remove_column</span><span class="method-args">(table_name, column_name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000799-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000799-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 471</span>
471:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_column</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">column_name</span>)
472:         <span class="ruby-identifier">remove_check_constraints</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">column_name</span>)
473:         <span class="ruby-identifier">remove_default_constraint</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">column_name</span>)
474:         <span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;ALTER TABLE [#{table_name}] DROP COLUMN [#{column_name}]&quot;</span>
475:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000800" class="method-detail">
        <a name="M000800"></a>

        <div class="method-heading">
          <a href="#M000800" class="method-signature">
          <span class="method-name">remove_default_constraint</span><span class="method-args">(table_name, column_name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000800-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000800-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 477</span>
477:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_default_constraint</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">column_name</span>)
478:         <span class="ruby-identifier">constraints</span> = <span class="ruby-identifier">select</span> <span class="ruby-node">&quot;select def.name from sysobjects def, syscolumns col, sysobjects tab where col.cdefault = def.id and col.name = '#{column_name}' and tab.name = '#{table_name}' and col.id = tab.id&quot;</span>
479:         
480:         <span class="ruby-identifier">constraints</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">constraint</span><span class="ruby-operator">|</span>
481:           <span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;ALTER TABLE #{table_name} DROP CONSTRAINT #{constraint[&quot;name&quot;]}&quot;</span>
482:         <span class="ruby-keyword kw">end</span>
483:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000802" class="method-detail">
        <a name="M000802"></a>

        <div class="method-heading">
          <a href="#M000802" class="method-signature">
          <span class="method-name">remove_index</span><span class="method-args">(table_name, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000802-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000802-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 493</span>
493:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_index</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">options</span> = {})
494:         <span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;DROP INDEX #{table_name}.#{quote_column_name(index_name(table_name, options))}&quot;</span>
495:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000798" class="method-detail">
        <a name="M000798"></a>

        <div class="method-heading">
          <a href="#M000798" class="method-signature">
          <span class="method-name">rename_column</span><span class="method-args">(table, column, new_column_name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000798-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000798-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 456</span>
456:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rename_column</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">column</span>, <span class="ruby-identifier">new_column_name</span>)
457:         <span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;EXEC sp_rename '#{table}.#{column}', '#{new_column_name}'&quot;</span>
458:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000796" class="method-detail">
        <a name="M000796"></a>

        <div class="method-heading">
          <a href="#M000796" class="method-signature">
          <span class="method-name">rename_table</span><span class="method-args">(name, new_name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000796-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000796-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 442</span>
442:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rename_table</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">new_name</span>)
443:         <span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;EXEC sp_rename '#{name}', '#{new_name}'&quot;</span>
444:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000785" class="method-detail">
        <a name="M000785"></a>

        <div class="method-heading">
          <a href="#M000785" class="method-signature">
          <span class="method-name">rollback_db_transaction</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000785-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000785-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 338</span>
338:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rollback_db_transaction</span>
339:         <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">rollback</span>
340:       <span class="ruby-keyword kw">ensure</span>
341:         <span class="ruby-ivar">@connection</span>[<span class="ruby-value str">&quot;AutoCommit&quot;</span>] = <span class="ruby-keyword kw">true</span>
342:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000794" class="method-detail">
        <a name="M000794"></a>

        <div class="method-heading">
          <a href="#M000794" class="method-signature">
          <span class="method-name">tables</span><span class="method-args">(name = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000794-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000794-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 415</span>
415:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tables</span>(<span class="ruby-identifier">name</span> = <span class="ruby-keyword kw">nil</span>)
416:         <span class="ruby-identifier">execute</span>(<span class="ruby-value str">&quot;SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE'&quot;</span>, <span class="ruby-identifier">name</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sth</span><span class="ruby-operator">|</span>
417:           <span class="ruby-identifier">sth</span>.<span class="ruby-identifier">inject</span>([]) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tables</span>, <span class="ruby-identifier">field</span><span class="ruby-operator">|</span>
418:             <span class="ruby-identifier">table_name</span> = <span class="ruby-identifier">field</span>[<span class="ruby-value">0</span>]
419:             <span class="ruby-identifier">tables</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">table_name</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">table_name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'dtproperties'</span>
420:             <span class="ruby-identifier">tables</span>
421:           <span class="ruby-keyword kw">end</span>
422:         <span class="ruby-keyword kw">end</span>
423:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000780" class="method-detail">
        <a name="M000780"></a>

        <div class="method-heading">
          <a href="#M000780" class="method-signature">
          <span class="method-name">update</span><span class="method-args">(sql, name = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000780-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000780-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/connection_adapters/sqlserver_adapter.rb, line 300</span>
300:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">name</span> = <span class="ruby-keyword kw">nil</span>)
301:         <span class="ruby-identifier">execute</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">name</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">handle</span><span class="ruby-operator">|</span>
302:           <span class="ruby-identifier">handle</span>.<span class="ruby-identifier">rows</span>
303:         <span class="ruby-keyword kw">end</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">select_one</span>(<span class="ruby-value str">&quot;SELECT @@ROWCOUNT AS AffectedRows&quot;</span>)[<span class="ruby-value str">&quot;AffectedRows&quot;</span>]        
304:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>